<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MATHEMAGICAL</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap');

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        body {
            font-family: 'Quicksand', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f0f1e, #1a1a2e);
            background-size: 300% 300%;
            animation: gradientShift 20s ease infinite;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            color: #fff;
        }

        h1 {
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            margin: 8px 0 5px 0;
            text-shadow: 0 0 20px rgba(184, 134, 11, 0.3);
            letter-spacing: 3px;
            background: linear-gradient(135deg, #b8860b, #daa520, #b8860b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        #title {
            display: inline-block;
        }

        #title span {
            display: inline-block;
            animation: float 3s ease-in-out infinite;
        }

        #title span:nth-child(1) { animation-delay: 0s; }
        #title span:nth-child(2) { animation-delay: 0.1s; }
        #title span:nth-child(3) { animation-delay: 0.2s; }
        #title span:nth-child(4) { animation-delay: 0.3s; }
        #title span:nth-child(5) { animation-delay: 0.4s; }
        #title span:nth-child(6) { animation-delay: 0.5s; }
        #title span:nth-child(7) { animation-delay: 0.6s; }
        #title span:nth-child(8) { animation-delay: 0.7s; }
        #title span:nth-child(9) { animation-delay: 0.8s; }
        #title span:nth-child(10) { animation-delay: 0.9s; }
        #title span:nth-child(11) { animation-delay: 1s; }
        #title span:nth-child(12) { animation-delay: 1.1s; }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }

        .subtitle {
            font-size: clamp(0.75rem, 2vw, 0.95rem);
            margin-bottom: 8px;
            opacity: 0.7;
            text-align: center;
            color: #c9c9c9;
            font-style: italic;
        }

        .game-container {
            background: rgba(0, 0, 0, 0.3);
            padding: clamp(8px, 1.5vw, 12px);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 900px;
            width: 100%;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: clamp(6px, 1.5vw, 10px);
            margin: 8px auto;
            max-width: 800px;
            width: 100%;
        }

        .card {
            aspect-ratio: 1/1;
            background: linear-gradient(135deg, #f8f8f3 0%, #f0f0e8 50%, #f8f8f3 100%);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            cursor: grab;
            position: relative;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            padding: clamp(4px, 1vw, 6px);
            min-width: 0;
            border: 1px solid #ddd;
        }

        .card:active {
            cursor: grabbing;
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.6);
        }

        .card.selected {
            border: 3px solid #b8860b;
            transform: scale(1.03);
        }

        .card.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .card.drag-over {
            border: 3px dashed #b8860b;
        }

        .card.correct {
            background: linear-gradient(135deg, #d4af37 0%, #b8860b 100%);
            border-color: #b8860b;
        }

        .card.correct .clue {
            color: #000 !important;
        }

        .card-number {
            font-size: clamp(4rem, 12vw, 7rem);
            font-weight: 700;
            text-align: center;
            margin: auto 0 0 0;
            line-height: 0.85;
        }

        .card-number.red {
            color: #d32f2f;
        }

        .card-number.black {
            color: #000;
        }

        .suit {
            font-size: clamp(2rem, 6vw, 3.5rem);
            text-align: center;
            margin: 0 0 auto 0;
            line-height: 0.9;
        }

        .suit.red {
            color: #d32f2f;
        }

        .suit.black {
            color: #000;
        }

        .clue {
            font-size: clamp(0.8rem, 2.3vw, 1.15rem);
            text-align: center;
            color: #555;
            margin-top: auto;
            line-height: 1.2;
            padding: clamp(3px, 0.8vw, 5px);
            font-weight: 500;
        }

        .clue-red {
            color: #d32f2f;
            font-weight: 700;
        }

        .clue-black {
            color: #000;
            font-weight: 700;
        }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        button {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: clamp(8px, 2vw, 12px) clamp(16px, 4vw, 24px);
            border-radius: 20px;
            font-size: clamp(0.8rem, 2vw, 1rem);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            color: #fff;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            background: rgba(255, 255, 255, 0.25);
        }

        button:active {
            transform: translateY(0);
        }

        .message {
            text-align: center;
            font-size: clamp(0.9rem, 2.5vw, 1.1rem);
            margin: 5px 0;
            min-height: 22px;
            font-weight: bold;
        }

        .victory {
            color: #d4af37;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .moves-counter {
            font-size: clamp(0.75rem, 1.8vw, 0.9rem);
            text-align: center;
            margin: 8px 0 4px 0;
            opacity: 0.85;
        }

        @media (max-width: 600px) {
            .grid {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <h1 id="title">MATHEMAGICAL</h1>
    <div class="subtitle">Arrange the cards to satisfy all clues</div>
    
    <div class="game-container">
        <div class="message" id="message"></div>
        <div class="grid" id="grid"></div>
        <div class="controls">
            <button onclick="newGame()">New Puzzle</button>
            <button onclick="checkSolution()">Check Solution</button>
            <button onclick="revealSolution()">Reveal Solution</button>
        </div>
        <div class="moves-counter">Guesses: <span id="moveCount">0</span></div>
    </div>

    <script>
        const suits = {
            spade: 'â™ ',
            club: 'â™£',
            heart: 'â™¥',
            diamond: 'â™¦'
        };

        let currentPuzzle = null;
        let selectedCard = null;
        let moves = 0;
        let draggedIndex = null;

        // Helper function to validate clues
        function validatePuzzle(puzzle) {
            const grid = puzzle.solution;
            const errors = [];
            
            grid.forEach((card, index) => {
                const row = Math.floor(index / 3);
                const col = index % 3;
                const isRed = card.suit === 'heart' || card.suit === 'diamond';
                
                // Get neighbors
                const left = col > 0 ? grid[index - 1] : null;
                const right = col < 2 ? grid[index + 1] : null;
                const above = row > 0 ? grid[index - 3] : null;
                const below = row < 1 ? grid[index + 3] : null;
                
                // Get row and column
                const rowCards = [grid[row * 3], grid[row * 3 + 1], grid[row * 3 + 2]];
                const colCards = [grid[col], grid[col + 3]];
                
                console.log(`Card ${card.num}${card.suit} at [${row},${col}]: "${card.clue}"`);
            });
            
            return errors;
        }

        const puzzles = [
            // Puzzle 1 - Grid layout:
            // Row 0: [0]=2â™   [1]=5â™¥  [2]=8â™£
            // Row 1: [3]=3â™¦  [4]=6â™   [5]=9â™¥
            // Strategy: Use unique identifying facts that interlock
            {
                solution: [
                    {num: 2, suit: 'spade', clue: 'Top-left corner position'},
                    {num: 5, suit: 'heart', clue: 'My column sums to 11'},
                    {num: 8, suit: 'club', clue: 'Largest black card in grid'},
                    {num: 3, suit: 'diamond', clue: 'Only red card in my column'},
                    {num: 6, suit: 'spade', clue: 'Two red cards in my row'},
                    {num: 9, suit: 'heart', clue: 'Largest card in entire grid'}
                ]
            },
            // Puzzle 2 - Grid layout:
            // Row 0: [0]=1â™£  [1]=7â™¦  [2]=4â™ 
            // Row 1: [3]=6â™¥  [4]=2â™£  [5]=8â™¦
            {
                solution: [
                    {num: 1, suit: 'club', clue: 'Smallest card in entire grid'},
                    {num: 7, suit: 'diamond', clue: 'My row sums to 12'},
                    {num: 4, suit: 'spade', clue: 'My column sums to 12'},
                    {num: 6, suit: 'heart', clue: 'Only red card in my column'},
                    {num: 2, suit: 'club', clue: 'Center position of grid'},
                    {num: 8, suit: 'diamond', clue: 'Bottom-right corner position'}
                ]
            },
            // Puzzle 3 - Grid layout:
            // Row 0: [0]=3â™¥  [1]=8â™   [2]=5â™¦
            // Row 1: [3]=9â™£  [4]=1â™¥  [5]=7â™ 
            {
                solution: [
                    {num: 3, suit: 'heart', clue: 'My row sums to 16'},
                    {num: 8, suit: 'spade', clue: 'Two red cards in my row'},
                    {num: 5, suit: 'diamond', clue: 'My column sums to 12'},
                    {num: 9, suit: 'club', clue: 'Largest black card in grid'},
                    {num: 1, suit: 'heart', clue: 'Smallest card in entire grid'},
                    {num: 7, suit: 'spade', clue: 'My column sums to 12'}
                ]
            },
            // Puzzle 4 - Grid layout:
            // Row 0: [0]=4â™£  [1]=6â™¦  [2]=2â™ 
            // Row 1: [3]=7â™¥  [4]=3â™£  [5]=9â™¦
            {
                solution: [
                    {num: 4, suit: 'club', clue: 'My column sums to 11'},
                    {num: 6, suit: 'diamond', clue: 'Only red card in my column'},
                    {num: 2, suit: 'spade', clue: 'Smallest black card in grid'},
                    {num: 7, suit: 'heart', clue: 'Only red card in my column'},
                    {num: 3, suit: 'club', clue: 'My row sums to 19'},
                    {num: 9, suit: 'diamond', clue: 'Largest card in entire grid'}
                ]
            },
            // Puzzle 5 - Grid layout:
            // Row 0: [0]=5â™   [1]=2â™¥  [2]=7â™£
            // Row 1: [3]=4â™¦  [4]=8â™   [5]=1â™¥
            {
                solution: [
                    {num: 5, suit: 'spade', clue: 'My column sums to 9'},
                    {num: 2, suit: 'heart', clue: 'Two black cards in my row'},
                    {num: 7, suit: 'club', clue: 'My column sums to 8'},
                    {num: 4, suit: 'diamond', clue: 'My row sums to 13'},
                    {num: 8, suit: 'spade', clue: 'Largest black card in grid'},
                    {num: 1, suit: 'heart', clue: 'Smallest card in entire grid'}
                ]
            }
        ];

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function isSolved(cards, solution) {
            return cards.every((card, i) => 
                card.num === solution[i].num && card.suit === solution[i].suit
            );
        }

        function newGame() {
            currentPuzzle = puzzles[Math.floor(Math.random() * puzzles.length)];
            
            // Validate puzzle (for debugging)
            validatePuzzle(currentPuzzle);
            
            let shuffled = shuffleArray(currentPuzzle.solution);
            
            // Make sure it's not already solved
            while (isSolved(shuffled, currentPuzzle.solution)) {
                shuffled = shuffleArray(currentPuzzle.solution);
            }
            
            currentPuzzle.current = shuffled;
            moves = 0;
            selectedCard = null;
            document.getElementById('moveCount').textContent = moves;
            document.getElementById('message').textContent = '';
            renderGrid();
        }

        function formatClue(clueText) {
            // Replace color/suit keywords with styled spans
            let formatted = clueText;
            
            // Red suits and color
            formatted = formatted.replace(/\bheart\b/gi, '<span class="clue-red">heart</span>');
            formatted = formatted.replace(/\bhearts\b/gi, '<span class="clue-red">hearts</span>');
            formatted = formatted.replace(/\bdiamond\b/gi, '<span class="clue-red">diamond</span>');
            formatted = formatted.replace(/\bdiamonds\b/gi, '<span class="clue-red">diamonds</span>');
            formatted = formatted.replace(/\bred\b/gi, '<span class="clue-red">red</span>');
            
            // Black suits and color
            formatted = formatted.replace(/\bspade\b/gi, '<span class="clue-black">spade</span>');
            formatted = formatted.replace(/\bspades\b/gi, '<span class="clue-black">spades</span>');
            formatted = formatted.replace(/\bclub\b/gi, '<span class="clue-black">club</span>');
            formatted = formatted.replace(/\bclubs\b/gi, '<span class="clue-black">clubs</span>');
            formatted = formatted.replace(/\bblack\b/gi, '<span class="clue-black">black</span>');
            
            return formatted;
        }

        function renderGrid() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            
            currentPuzzle.current.forEach((card, index) => {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'card';
                cardDiv.draggable = true;
                cardDiv.onclick = () => selectCard(index);
                
                // Drag events
                cardDiv.ondragstart = (e) => handleDragStart(e, index);
                cardDiv.ondragend = (e) => handleDragEnd(e);
                cardDiv.ondragover = (e) => handleDragOver(e);
                cardDiv.ondragenter = (e) => handleDragEnter(e, index);
                cardDiv.ondragleave = (e) => handleDragLeave(e);
                cardDiv.ondrop = (e) => handleDrop(e, index);
                
                const isRed = card.suit === 'heart' || card.suit === 'diamond';
                const suitColor = isRed ? 'red' : 'black';
                
                cardDiv.innerHTML = `
                    <div class="card-number ${suitColor}">${card.num}</div>
                    <div class="suit ${suitColor}">${suits[card.suit]}</div>
                    <div class="clue">${formatClue(card.clue)}</div>
                `;
                
                grid.appendChild(cardDiv);
            });
        }

        function selectCard(index) {
            if (selectedCard === null) {
                selectedCard = index;
                document.querySelectorAll('.card')[index].classList.add('selected');
            } else if (selectedCard === index) {
                selectedCard = null;
                document.querySelectorAll('.card')[index].classList.remove('selected');
            } else {
                // Swap cards
                const temp = currentPuzzle.current[selectedCard];
                currentPuzzle.current[selectedCard] = currentPuzzle.current[index];
                currentPuzzle.current[index] = temp;
                
                moves++;
                document.getElementById('moveCount').textContent = moves;
                selectedCard = null;
                renderGrid();
            }
        }

        function checkSolution() {
            if (isSolved(currentPuzzle.current, currentPuzzle.solution)) {
                document.getElementById('message').innerHTML = 
                    `<span class="victory">ðŸŽ‰ SOLVED in ${moves} ${moves === 1 ? 'guess' : 'guesses'}! ðŸŽ‰</span>`;
                highlightCorrect();
            } else {
                document.getElementById('message').innerHTML = 
                    `<span style="color: #ff6b6b">Not quite right yet. Keep trying!</span>`;
            }
        }

        function revealSolution() {
            currentPuzzle.current = [...currentPuzzle.solution];
            selectedCard = null;
            renderGrid();
            document.getElementById('message').innerHTML = 
                `<span style="color: #FFD700">âœ¨ Solution revealed! âœ¨</span>`;
            highlightCorrect();
        }

        function handleDragStart(e, index) {
            draggedIndex = index;
            e.currentTarget.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            e.currentTarget.classList.remove('dragging');
            document.querySelectorAll('.card').forEach(card => {
                card.classList.remove('drag-over');
            });
            draggedIndex = null;
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDragEnter(e, index) {
            if (draggedIndex !== null && draggedIndex !== index) {
                e.currentTarget.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e, dropIndex) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            if (draggedIndex !== null && draggedIndex !== dropIndex) {
                // Swap cards
                const temp = currentPuzzle.current[draggedIndex];
                currentPuzzle.current[draggedIndex] = currentPuzzle.current[dropIndex];
                currentPuzzle.current[dropIndex] = temp;
                
                moves++;
                document.getElementById('moveCount').textContent = moves;
                renderGrid();
            }
            
            return false;
        }

        function highlightCorrect() {
            document.querySelectorAll('.card').forEach(card => {
                card.classList.add('correct');
            });
        }

        // Animate title letters
        window.addEventListener('DOMContentLoaded', () => {
            const title = document.getElementById('title');
            const text = title.textContent;
            title.innerHTML = text.split('').map(letter => 
                `<span>${letter}</span>`
            ).join('');
        });

        // Start the game
        newGame();
    </script>
</body>
</html>
